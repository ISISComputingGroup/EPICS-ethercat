<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ethercat: SDO Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>SDO Support </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="sdo_initialization"></a>
Specification at scanner initialization</h2>
<p>SDO requests are registered in the scanner configuration</p>
<p>The section &lt;sdorequests&gt; is parsed to the configuration structures</p>
<p>Example:</p>
<p>&lt;sdorequests&gt;<br/>
 &lt;sdo name="DOX Settings Ch. 1" slave="EA1.11" index="0x8000" &gt;<br/>
 &lt;sdoentry description="Voltage Output" subindex="0x8" bit_length="8" asynparameter="voltage"/&gt;<br/>
 &lt;/sdo&gt;<br/>
 &lt;/sdorequests&gt;<br/>
</p>
<h2><a class="anchor" id="sdo_size"></a>
SDO size supported</h2>
<p>The Ethercat specification supports any size SDO. This implementation limits the support to 32-bit entries, because of the use of asynInt32 parameters in the EPICS side.</p>
<p>For example, the table below shows the types of SDOS in the EL2595 and the range supported.</p>
<table class="doxtable">
<tr>
<td><b>type</b> </td><td><b>bit_length</b> </td><td><b>supported (Y/N)</b>  </td></tr>
<tr>
<td>type 0000 </td><td>0 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>bool </td><td>1 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>type 0000 </td><td>2 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>type 0000 </td><td>3 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>type 0000 </td><td>4 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>type 0000 </td><td>5 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>type 0000 </td><td>7 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>uint8 </td><td>8 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>string </td><td>16 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>uint32 </td><td>32 bit </td><td><p class="starttd">Y </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>string </td><td>48 bit </td><td><p class="starttd">NO </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>uint64 </td><td>64 bit </td><td><p class="starttd">NO </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>octet_string </td><td>224 bit </td><td>NO  </td></tr>
</table>
<h2><a class="anchor" id="sdo_scanner_comms"></a>
Scanner to EPICS communications</h2>
<p>These message types are used:</p>
<p>MSG_SDO_REQ a read request from the client (EPICS) MSG_SDO_WRITE a write request from the client (EPICS) MSG_SDO_READ an answer from the scanner</p>
<p>The request can be in one of these states (ethercat library's ec_requets_state_t)</p>
<p>EC_REQUEST_UNUSED, Not requested. EC_REQUEST_BUSY, Request is being processed. EC_REQUEST_SUCCESS, Request was processed successfully. EC_REQUEST_ERROR, Request processing failed.</p>
<h2><a class="anchor" id="sdo_read_request"></a>
Read request</h2>
<p>An EPICS record is processed for a read request.</p>
<p>e.g. record(longin, "DEVICE:OUTPUT_VOLTAGE") { field(DTYP, "asynInt32") field(INP, "@asyn(ERIO.1)voltage") field(SCAN, "1 second") }</p>
<p>record(mbbi, "DEVICE:OUTPUT_VOLTAGE:STAT") { field(DTYP, "asynInt32") field(INP, "@asyn(ERIO.1)voltage_stat)
    field(SCAN, "1 second")
    field("ONVL", "0")
    field("TWVL", "1")
    field("THVL", "2")
    field("FRVL", "3")
    field("ONST", "UNUSED")
    field("TWST", "BUSY")
    field("THST", "SUCCESS")
    field("FRST", "ERROR") }</p>
<h2><a class="anchor" id="sdo_write_request"></a>
Write request</h2>
<p>Example EPICS record for read/write.</p>
<p>record(longout, "DEVICE:OUTPUT_VOLTAGE") { field(DTYP, "asynInt32") field(INP, "@asyn(ERIO.1)voltage") field(OMSL, "supervisory") }</p>
<h2><a class="anchor" id="sdo_cyclic_read"></a>
read request in cyclic_task</h2>
<p>The cyclic task in the scanner will retrieve the status of the sdo requests on every tick (function gather_sdo_states)</p>
<p>The function gather_sdo_states also marks a flag for requests for which the state has changed. These should generate an answer from the scanner, which is an MSG_SDO_READ message to return to the clients.</p>
<p>When a MSG_SDO_REQ message arrives, the request will be registered in using the process_sdo_read_request function that will issue a read request only when the associated state for the request is not busy.</p>
<h2><a class="anchor" id="sdo_write_sdo"></a>
write sdo requests from IOC</h2>
<p>The IOC "engine" has two methods</p>
<h3><a class="anchor" id="sdo_write_method1"></a>
ioc_send/pdo_data</h3>
<p>These functions process messages from the receive buffer, that is packets sent by the scanner. For SDOs these will be replies from the scanner about status of the read request and a value.</p>
<h3><a class="anchor" id="sdo_write_method2"></a>
ioc_receive</h3>
<p>This function adds messages to the writeq, from the send_buffer. For SDOs, these will be the read requests and write requests.</p>
<h2><a class="anchor" id="Separate"></a>
asyn port class for SDO requests</h2>
<p>The class <a class="el" href="classecSdoAsyn.html">ecSdoAsyn</a> implements the blocking port for the sdo read/write requests.</p>
<p>An instance will be created by its parent <a class="el" href="classecAsyn.html">ecAsyn</a> port class if there are sdos registered for that port (sdos &gt; 0). (Implementation in readConfig function in <a class="el" href="ecAsyn_8cpp.html">ecAsyn.cpp</a>)</p>
<p>The class instance receives messages from the scanner. All instances are registered in the list sdo_observers list and implement the on_sdo_message method. </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Jan 29 2015 09:30:36 for ethercat by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
